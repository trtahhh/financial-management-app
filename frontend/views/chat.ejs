<main class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <div class="d-flex align-items-center">
            <i class="bi bi-robot me-2 fs-4"></i>
            <div>
              <h5 class="mb-0">ğŸ¤– AI TÆ° váº¥n tÃ i chÃ­nh</h5>
              <small>Trá»£ lÃ½ AI thÃ´ng minh cho quáº£n lÃ½ tÃ i chÃ­nh cÃ¡ nhÃ¢n</small>
            </div>
          </div>
        </div>
        
        <div class="card-body p-0">
          <!-- Chat Messages Area -->
          <div class="chat-messages" id="chat-messages" style="height: 400px; overflow-y: auto; padding: 20px; background-color: #f8f9fa;">
            <div class="alert alert-info border-0">
              <div class="d-flex align-items-start">
                <span class="badge bg-success me-2 mt-1">ğŸ¤– AI</span>
                <div>
                  <strong>Xin chÃ o!</strong> TÃ´i lÃ  trá»£ lÃ½ AI tÃ i chÃ­nh cá»§a báº¡n. TÃ´i cÃ³ thá»ƒ giÃºp báº¡n:
                  <ul class="mb-0 mt-2">
                    <li>ğŸ’° TÆ° váº¥n láº­p ngÃ¢n sÃ¡ch cÃ¡ nhÃ¢n</li>
                    <li>ğŸ“Š PhÃ¢n tÃ­ch thÃ³i quen chi tiÃªu</li>
                    <li>ğŸ¯ Äáº·t má»¥c tiÃªu tÃ i chÃ­nh thÃ´ng minh</li>
                    <li>ğŸ“ˆ HÆ°á»›ng dáº«n Ä‘áº§u tÆ° cÆ¡ báº£n cho sinh viÃªn</li>
                    <li>ğŸ¦ Máº¹o tiáº¿t kiá»‡m hiá»‡u quáº£ hÃ ng ngÃ y</li>
                  </ul>
                  <div class="mt-2">
                    <strong>HÃ£y báº¯t Ä‘áº§u báº±ng cÃ¡ch há»i tÃ´i Ä‘iá»u gÃ¬ Ä‘Ã³!</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Quick Action Buttons -->
          <div class="border-top p-3 bg-white">
            <div class="row g-2">
              <div class="col-6 col-md-3">
                <button class="btn btn-outline-primary btn-sm w-100" onclick="quickQuestion('budget')">
                  ğŸ’° NgÃ¢n sÃ¡ch
                </button>
              </div>
              <div class="col-6 col-md-3">
                <button class="btn btn-outline-success btn-sm w-100" onclick="quickQuestion('saving')">
                  ğŸ¦ Tiáº¿t kiá»‡m
                </button>
              </div>
              <div class="col-6 col-md-3">
                <button class="btn btn-outline-info btn-sm w-100" onclick="quickQuestion('spending')">
                  ğŸ“Š Chi tiÃªu
                </button>
              </div>
              <div class="col-6 col-md-3">
                <button class="btn btn-outline-warning btn-sm w-100" onclick="quickQuestion('investment')">
                  ğŸ“ˆ Äáº§u tÆ°
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Chat Input -->
        <div class="card-footer bg-white border-top">
          <div class="input-group">
            <input type="text" class="form-control" id="chat-input" 
                   placeholder="Nháº­p cÃ¢u há»i cá»§a báº¡n..." 
                   onkeypress="handleKeyPress(event)"
                   style="border-radius: 25px 0 0 25px;">
            <button class="btn btn-primary px-4" onclick="sendMessage()" style="border-radius: 0 25px 25px 0;">
              <i class="bi bi-send"></i>
            </button>
          </div>
          <div class="mt-2 text-center">
            <small class="text-muted">
              ğŸ’¡ Thá»­ há»i: "LÃ m sao Ä‘á»ƒ tiáº¿t kiá»‡m tiá»n hiá»‡u quáº£?" â€¢ "CÃ¡ch láº­p ngÃ¢n sÃ¡ch cho sinh viÃªn?"
            </small>
          </div>
        </div>
      </div>
      
      <!-- AI Features Overview -->
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card border-0 bg-light">
            <div class="card-body text-center">
              <i class="bi bi-lightbulb text-warning fs-2"></i>
              <h6 class="mt-2">TÆ° váº¥n thÃ´ng minh</h6>
              <small class="text-muted">AI phÃ¢n tÃ­ch tÃ i chÃ­nh cÃ¡ nhÃ¢n vÃ  Ä‘Æ°a ra lá»i khuyÃªn phÃ¹ há»£p</small>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card border-0 bg-light">
            <div class="card-body text-center">
              <i class="bi bi-graph-up text-success fs-2"></i>
              <h6 class="mt-2">PhÃ¢n tÃ­ch dá»¯ liá»‡u</h6>
              <small class="text-muted">Hiá»ƒu sÃ¢u vá» thÃ³i quen tÃ i chÃ­nh vÃ  xu hÆ°á»›ng chi tiÃªu cá»§a báº¡n</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
let chatHistory = [];
let isProcessing = false;

function handleKeyPress(event) {
  if (event.key === 'Enter' && !event.shiftKey) {
    event.preventDefault();
    sendMessage();
  }
}

function quickQuestion(type) {
  const questions = {
    budget: "LÃ m tháº¿ nÃ o Ä‘á»ƒ láº­p ngÃ¢n sÃ¡ch hiá»‡u quáº£ cho sinh viÃªn vá»›i thu nháº­p khÃ´ng á»•n Ä‘á»‹nh?",
    saving: "CÃ³ nhá»¯ng cÃ¡ch nÃ o Ä‘á»ƒ tiáº¿t kiá»‡m tiá»n hÃ ng ngÃ y mÃ  váº«n Ä‘áº£m báº£o cháº¥t lÆ°á»£ng cuá»™c sá»‘ng?",
    spending: "HÃ£y phÃ¢n tÃ­ch vÃ  Ä‘Æ°a ra lá»i khuyÃªn vá» thÃ³i quen chi tiÃªu cá»§a tÃ´i",
    investment: "Sinh viÃªn nhÆ° tÃ´i nÃªn báº¯t Ä‘áº§u Ä‘áº§u tÆ° nhÆ° tháº¿ nÃ o vá»›i sá»‘ tiá»n Ã­t?"
  };
  
  const input = document.getElementById('chat-input');
  input.value = questions[type];
  input.focus();
  sendMessage();
}

async function sendMessage() {
  if (isProcessing) return;
  
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  isProcessing = true;
  
  // Add user message
  addMessage('user', message);
  input.value = '';
  
  // Show typing indicator
  const typingId = addMessage('ai', 'Äang suy nghÄ©...', true);
  
  try {
    // Simulate processing delay
    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    
    // Remove typing indicator
    removeMessage(typingId);
    
    // Generate and add AI response
    const response = generateAIResponse(message);
    addMessage('ai', response);
    
  } catch (error) {
    console.error('Chat error:', error);
    removeMessage(typingId);
    addMessage('ai', 'Xin lá»—i, tÃ´i gáº·p lá»—i khi xá»­ lÃ½ cÃ¢u há»i. Vui lÃ²ng thá»­ láº¡i sau. ğŸ˜…');
  } finally {
    isProcessing = false;
  }
}

function generateAIResponse(message) {
  const lowerMessage = message.toLowerCase();
  
  // Advanced keyword matching with context
  if (lowerMessage.includes('ngÃ¢n sÃ¡ch') || lowerMessage.includes('budget') || lowerMessage.includes('láº­p káº¿ hoáº¡ch')) {
    return `ğŸ¯ **HÆ°á»›ng dáº«n láº­p ngÃ¢n sÃ¡ch thÃ´ng minh:**

**BÆ°á»›c 1: TÃ­nh thu nháº­p thá»±c táº¿**
- Thu nháº­p tá»« há»c bá»•ng, lÃ m thÃªm, há»— trá»£ gia Ä‘Ã¬nh
- Trá»« Ä‘i thuáº¿ vÃ  cÃ¡c khoáº£n báº¯t buá»™c

**BÆ°á»›c 2: Ãp dá»¥ng quy táº¯c 50/30/20**
- **50% nhu cáº§u thiáº¿t yáº¿u:** Ä‚n, á»Ÿ, há»c phÃ­, Ä‘i láº¡i
- **30% mong muá»‘n:** Giáº£i trÃ­, mua sáº¯m, háº¹n hÃ²
- **20% tÆ°Æ¡ng lai:** Tiáº¿t kiá»‡m, tráº£ ná»£, Ä‘áº§u tÆ°

**BÆ°á»›c 3: Theo dÃµi vÃ  Ä‘iá»u chá»‰nh**
- DÃ¹ng app nÃ y Ä‘á»ƒ ghi chÃ©p chi tiÃªu hÃ ng ngÃ y
- Xem xÃ©t láº¡i ngÃ¢n sÃ¡ch má»—i thÃ¡ng
- Äiá»u chá»‰nh tá»· lá»‡ phÃ¹ há»£p vá»›i tÃ¬nh hÃ¬nh

ğŸ’¡ **Máº¹o hay:** Äáº·t má»¥c tiÃªu tiáº¿t kiá»‡m cá»¥ thá»ƒ (VD: mua laptop, Ä‘i du lá»‹ch) Ä‘á»ƒ cÃ³ Ä‘á»™ng lá»±c!`;
  }
  
  if (lowerMessage.includes('tiáº¿t kiá»‡m') || lowerMessage.includes('saving') || lowerMessage.includes('save money')) {
    return `ğŸ’° **Chiáº¿n lÆ°á»£c tiáº¿t kiá»‡m hiá»‡u quáº£:**

**ğŸ³ Ä‚n uá»‘ng:**
- Náº¥u Äƒn táº¡i nhÃ : tiáº¿t kiá»‡m 60-70% so vá»›i Äƒn ngoÃ i
- Mang cÆ¡m trÆ°a Ä‘i há»c/lÃ m
- Mua thá»±c pháº©m theo mÃ¹a, Ä‘i chá»£ cuá»‘i ngÃ y

**ğŸšŒ Di chuyá»ƒn:**
- Sá»­ dá»¥ng phÆ°Æ¡ng tiá»‡n cÃ´ng cá»™ng
- Äi bá»™/xe Ä‘áº¡p cho quÃ£ng Ä‘Æ°á»ng ngáº¯n
- Chia sáº» xe vá»›i báº¡n bÃ¨

**ğŸ›’ Mua sáº¯m thÃ´ng minh:**
- Láº­p danh sÃ¡ch trÆ°á»›c khi mua
- So sÃ¡nh giÃ¡ trÆ°á»›c khi quyáº¿t Ä‘á»‹nh
- Mua Ä‘á»“ cÅ© cháº¥t lÆ°á»£ng tá»‘t
- Chá» sale/khuyáº¿n mÃ£i cho Ä‘á»“ khÃ´ng gáº¥p

**ğŸ’¡ Rule 24h:** Chá» 24h trÆ°á»›c khi mua Ä‘á»“ > 500k Ä‘á»ƒ trÃ¡nh mua impulsive!

ğŸ¯ **Má»¥c tiÃªu:** Báº¯t Ä‘áº§u vá»›i tiáº¿t kiá»‡m 100k/thÃ¡ng, tÄƒng dáº§n theo thu nháº­p!`;
  }
  
  if (lowerMessage.includes('Ä‘áº§u tÆ°') || lowerMessage.includes('investment') || lowerMessage.includes('invest')) {
    return `ğŸ“ˆ **Äáº§u tÆ° cÆ¡ báº£n cho ngÆ°á»i má»›i:**

**ğŸ’ NguyÃªn táº¯c vÃ ng:**
1. **CÃ³ quá»¹ kháº©n cáº¥p trÆ°á»›c:** 3-6 thÃ¡ng chi tiÃªu
2. **Báº¯t Ä‘áº§u sá»›m, dÃ¹ Ã­t:** 100k/thÃ¡ng cÅ©ng tá»‘t
3. **Äáº§u tÆ° Ä‘á»‹nh ká»³:** Dollar Cost Averaging
4. **Äa dáº¡ng hÃ³a:** KhÃ´ng bá» háº¿t trá»©ng vÃ o 1 giá»

**ğŸ† KÃªnh phÃ¹ há»£p sinh viÃªn:**
- **Quá»¹ má»Ÿ (Mutual Fund):** Ãt rá»§i ro, chuyÃªn gia quáº£n lÃ½
- **VÃ ng SJC mini:** Báº£o toÃ n giÃ¡ trá»‹, dá»… mua bÃ¡n
- **Tiáº¿t kiá»‡m cÃ³ ká»³ háº¡n:** 6-12 thÃ¡ng, lÃ£i suáº¥t á»•n Ä‘á»‹nh
- **ETF:** Äáº§u tÆ° chá»‰ sá»‘, phÃ­ tháº¥p

**âš ï¸ TrÃ¡nh:**
- Äáº§u tÆ° báº±ng tiá»n vay
- Bá» háº¿t vÃ o 1 cá»• phiáº¿u
- Tin theo "tips" trÃªn máº¡ng
- FOMO (Fear of Missing Out)

ğŸ¯ **Báº¯t Ä‘áº§u:** 200-500k/thÃ¡ng vÃ o quá»¹ má»Ÿ, tÄƒng dáº§n theo thu nháº­p!`;
  }
  
  if (lowerMessage.includes('phÃ¢n tÃ­ch') || lowerMessage.includes('chi tiÃªu') || lowerMessage.includes('spending')) {
    return `ğŸ“Š **PhÃ¢n tÃ­ch chi tiÃªu thÃ´ng minh:**

**ğŸ” CÃ¡c chá»‰ sá»‘ cáº§n theo dÃµi:**
- **Chi tiÃªu theo danh má»¥c:** Xem Ä‘Ã¢u tá»‘n nhiá»u nháº¥t
- **Tá»· lá»‡ chi/thu:** KhÃ´ng nÃªn > 80% thu nháº­p
- **Xu hÆ°á»›ng theo thÃ¡ng:** TÄƒng/giáº£m ra sao?
- **Chi tiÃªu báº¥t thÆ°á»ng:** Nhá»¯ng khoáº£n lá»›n ngoÃ i dá»± kiáº¿n

**ğŸ“± CÃ¡ch sá»­ dá»¥ng app hiá»‡u quáº£:**
1. Ghi chÃ©p ngay sau khi chi tiÃªu
2. DÃ¹ng AI phÃ¢n loáº¡i tá»± Ä‘á»™ng
3. Xem bÃ¡o cÃ¡o Dashboard hÃ ng tuáº§n
4. Äáº·t alert khi sáº¯p vÆ°á»£t ngÃ¢n sÃ¡ch

**ğŸ’¡ PhÆ°Æ¡ng phÃ¡p 80/20:**
- 20% nguyÃªn nhÃ¢n táº¡o ra 80% chi tiÃªu
- Táº­p trung kiá»ƒm soÃ¡t nhá»¯ng khoáº£n chi lá»›n nháº¥t

**ğŸ¯ Máº¹o hay:**
- Chá»¥p áº£nh hÃ³a Ä‘Æ¡n â†’ AI sáº½ tá»± Ä‘á»™ng nháº­p liá»‡u
- Äáº·t budget alert á»Ÿ 80% Ä‘á»ƒ ká»‹p thá»i Ä‘iá»u chá»‰nh
- Review chi tiÃªu má»—i chá»§ nháº­t

ğŸ“ˆ **Má»¥c tiÃªu:** Giáº£m 10-15% chi tiÃªu khÃ´ng cáº§n thiáº¿t má»—i thÃ¡ng!`;
  }
  
  if (lowerMessage.includes('má»¥c tiÃªu') || lowerMessage.includes('goal') || lowerMessage.includes('káº¿ hoáº¡ch')) {
    return `ğŸ¯ **Äáº·t má»¥c tiÃªu tÃ i chÃ­nh SMART:**

**S - Specific (Cá»¥ thá»ƒ):**
- "Mua laptop 20 triá»‡u" thay vÃ¬ "mua laptop"
- "Tiáº¿t kiá»‡m 500k/thÃ¡ng" thay vÃ¬ "tiáº¿t kiá»‡m nhiá»u"

**M - Measurable (Äo Ä‘Æ°á»£c):**
- Sá»‘ tiá»n cá»¥ thá»ƒ: 5 triá»‡u, 10 triá»‡u
- Thá»i gian rÃµ rÃ ng: 6 thÃ¡ng, 1 nÄƒm

**A - Achievable (Kháº£ thi):**
- PhÃ¹ há»£p vá»›i thu nháº­p hiá»‡n táº¡i
- KhÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n nhu cáº§u cÆ¡ báº£n

**R - Relevant (PhÃ¹ há»£p):**
- PhÃ¹ há»£p vá»›i hoÃ n cáº£nh sinh viÃªn
- Æ¯u tiÃªn theo táº§m quan trá»ng

**T - Time-bound (CÃ³ thá»i háº¡n):**
- Deadline cá»¥ thá»ƒ Ä‘á»ƒ táº¡o pressure tÃ­ch cá»±c

**ğŸ¯ VÃ­ dá»¥ má»¥c tiÃªu sinh viÃªn:**
- **Ngáº¯n háº¡n (3-6 thÃ¡ng):** Mua Ä‘iá»‡n thoáº¡i má»›i 8 triá»‡u
- **Trung háº¡n (6-12 thÃ¡ng):** Du lá»‹ch ÄÃ  Láº¡t 3 triá»‡u
- **DÃ i háº¡n (1-2 nÄƒm):** Quá»¹ kháº©n cáº¥p 15 triá»‡u

ğŸ’¡ **Trick:** Chia má»¥c tiÃªu lá»›n thÃ nh milestone nhá» Ä‘á»ƒ dá»… Ä‘áº¡t Ä‘Æ°á»£c!`;
  }
  
  if (lowerMessage.includes('sinh viÃªn') || lowerMessage.includes('student') || lowerMessage.includes('há»c sinh')) {
    return `ğŸ“ **TÃ i chÃ­nh thÃ´ng minh cho sinh viÃªn:**

**ğŸ’° Tá»‘i Æ°u thu nháº­p:**
- **Part-time:** Gia sÆ°, phá»¥c vá»¥, content creator
- **Online:** Freelance thiáº¿t káº¿, viáº¿t content, dá»‹ch thuáº­t
- **Passive:** BÃ¡n Ä‘á»“ cÅ©, cho thuÃª sÃ¡ch, affiliate marketing

**ğŸ  Tiáº¿t kiá»‡m chi phÃ­:**
- **á»:** á» ghÃ©p, á»Ÿ kÃ½ tÃºc xÃ¡ thay vÃ¬ thuÃª riÃªng
- **Ä‚n:** Náº¥u cÆ¡m táº­p thá»ƒ vá»›i báº¡n, mang cÆ¡m trÆ°a
- **Há»c:** SÃ¡ch photocopy, tÃ i liá»‡u online, thÆ° viá»‡n

**ğŸ“š Äáº§u tÆ° vÃ o báº£n thÃ¢n:**
- KhÃ³a há»c ká»¹ nÄƒng (marketing, IT, ngoáº¡i ngá»¯)
- Chá»©ng chá»‰ nghá» nghiá»‡p
- Networking, tham gia CLB

**ğŸ¯ Lá»™ trÃ¬nh tÃ i chÃ­nh 4 nÄƒm Ä‘áº¡i há»c:**
- **NÄƒm 1:** Há»c quáº£n lÃ½ tiá»n, táº¡o thÃ³i quen ghi chÃ©p
- **NÄƒm 2:** XÃ¢y dá»±ng quá»¹ kháº©n cáº¥p 3-5 triá»‡u
- **NÄƒm 3:** Báº¯t Ä‘áº§u Ä‘áº§u tÆ° nhá», lÃ m thÃªm á»•n Ä‘á»‹nh
- **NÄƒm 4:** Chuáº©n bá»‹ tÃ i chÃ­nh cho sau tá»‘t nghiá»‡p

ğŸ’¡ **Golden rule:** Sá»‘ng dÆ°á»›i kháº£ nÄƒng tÃ i chÃ­nh, Ä‘áº§u tÆ° vÃ o ká»¹ nÄƒng!`;
  }
  
  // Default comprehensive response
  return `ğŸ¤” Cáº£m Æ¡n cÃ¢u há»i thÃº vá»‹ cá»§a báº¡n vá» "${message}"!

TÃ´i lÃ  chuyÃªn gia AI vá» tÃ i chÃ­nh cÃ¡ nhÃ¢n, Ä‘áº·c biá»‡t hiá»ƒu rÃµ vá» tÃ¬nh hÃ¬nh cá»§a sinh viÃªn vÃ  ngÆ°á»i tráº» á»Ÿ Viá»‡t Nam.

**ğŸ¯ TÃ´i cÃ³ thá»ƒ giÃºp báº¡n:**
- ğŸ’° **Láº­p ngÃ¢n sÃ¡ch cÃ¡ nhÃ¢n** phÃ¹ há»£p vá»›i thu nháº­p khÃ´ng á»•n Ä‘á»‹nh
- ğŸ¦ **Chiáº¿n lÆ°á»£c tiáº¿t kiá»‡m** hiá»‡u quáº£ cho ngÆ°á»i tráº»
- ğŸ“Š **PhÃ¢n tÃ­ch chi tiÃªu** vÃ  tÃ¬m ra cÃ¡c "lá»— há»•ng" tÃ i chÃ­nh
- ğŸ“ˆ **HÆ°á»›ng dáº«n Ä‘áº§u tÆ°** cÆ¡ báº£n vá»›i vá»‘n Ã­t
- ğŸ¯ **Äáº·t má»¥c tiÃªu tÃ i chÃ­nh** SMART vÃ  kháº£ thi
- ğŸ’¡ **Máº¹o hay** quáº£n lÃ½ tiá»n báº¡c hÃ ng ngÃ y

**HÃ£y há»i cá»¥ thá»ƒ hÆ¡n** hoáº·c chá»n má»™t chá»§ Ä‘á» á»Ÿ phÃ­a trÃªn nhÃ©! TÃ´i sáº½ Ä‘Æ°a ra lá»i khuyÃªn chi tiáº¿t vÃ  thá»±c táº¿ nháº¥t cho báº¡n. ğŸ˜Š

*VÃ­ dá»¥: "LÃ m sao Ä‘á»ƒ tiáº¿t kiá»‡m 2 triá»‡u trong 6 thÃ¡ng vá»›i lÆ°Æ¡ng part-time 3 triá»‡u?"*`;
}

function addMessage(sender, content, isTyping = false) {
  const messagesContainer = document.getElementById('chat-messages');
  const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
  const messageDiv = document.createElement('div');
  messageDiv.className = 'mb-3';
  messageDiv.id = messageId;
  
  if (sender === 'user') {
    messageDiv.innerHTML = `
      <div class="d-flex justify-content-end">
        <div class="bg-primary text-white p-3 rounded-start rounded-bottom shadow-sm" style="max-width: 85%;">
          <div class="d-flex align-items-center mb-1">
            <span class="badge bg-light text-primary me-2">ğŸ‘¤</span>
            <small style="opacity: 0.9;">Báº¡n</small>
          </div>
          <div>${escapeHtml(content)}</div>
        </div>
      </div>
    `;
  } else {
    let displayContent = content;
    if (isTyping) {
      displayContent = `
        <div class="d-flex align-items-center">
          <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
          <span class="text-muted">${content}</span>
        </div>
      `;
    } else {
      // Format content with markdown-like styling
      displayContent = content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>')
        .replace(/^- (.*$)/gim, '<li>$1</li>')
        .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
    }
    
    messageDiv.innerHTML = `
      <div class="d-flex justify-content-start">
        <div class="bg-white border p-3 rounded-end rounded-bottom shadow-sm" style="max-width: 90%;">
          <div class="d-flex align-items-center mb-2">
            <span class="badge bg-success me-2">ğŸ¤–</span>
            <small class="text-success fw-bold">AI Assistant</small>
          </div>
          <div class="text-dark">${displayContent}</div>
        </div>
      </div>
    `;
  }
  
  messagesContainer.appendChild(messageDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Add to history (except typing messages)
  if (!isTyping) {
    chatHistory.push({ sender, content, timestamp: new Date() });
  }
  
  return messageId;
}

function removeMessage(messageId) {
  const messageElement = document.getElementById(messageId);
  if (messageElement) {
    messageElement.remove();
  }
}

function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}

function clearChat() {
  if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a toÃ n bá»™ cuá»™c trÃ² chuyá»‡n?')) {
    document.getElementById('chat-messages').innerHTML = `
      <div class="alert alert-info border-0">
        <div class="d-flex align-items-start">
          <span class="badge bg-success me-2 mt-1">ğŸ¤– AI</span>
          <div>
            <strong>Chat Ä‘Ã£ Ä‘Æ°á»£c xÃ³a!</strong> TÃ´i sáºµn sÃ ng giÃºp báº¡n vá»›i nhá»¯ng cÃ¢u há»i má»›i. ğŸ˜Š
          </div>
        </div>
      </div>
    `;
    chatHistory = [];
  }
}

// Auto-resize textarea and focus on load
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('chat-input');
  input.focus();
  
  // Add clear chat button
  const footer = document.querySelector('.card-footer');
  if (footer) {
    const clearBtn = document.createElement('div');
    clearBtn.className = 'mt-2 text-center';
    clearBtn.innerHTML = '<button class="btn btn-link btn-sm text-muted" onclick="clearChat()"><i class="bi bi-trash me-1"></i>XÃ³a cuá»™c trÃ² chuyá»‡n</button>';
    footer.appendChild(clearBtn);
  }
});
</script>

<style>
.chat-messages {
  scroll-behavior: smooth;
}

.badge {
  font-size: 0.7rem;
}

.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

.btn:hover {
  transform: translateY(-1px);
  transition: transform 0.2s ease;
}

.card {
  border: none;
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

#chat-input:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}
</style>