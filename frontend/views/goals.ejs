<main class="container py-4">
  <h2 class="mb-4">M·ª•c ti√™u t√†i ch√≠nh</h2>
  
  <style>
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    
    .goal-item, .completed-goal-item, .executed-goal-item {
      transition: all 0.3s ease;
    }
    
    .executed-goal-item {
      border: 2px solid #28a745;
    }
  </style>

  <!-- Goal Statistics -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h5 class="card-title">M·ª•c ti√™u ƒëang th·ª±c hi·ªán</h5>
          <h3 id="active-goals-count">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h5 class="card-title">M·ª•c ti√™u ƒë√£ ho√†n th√†nh</h5>
          <h3 id="completed-goals-count">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h5 class="card-title">T·ªïng ti·ªÅn ti·∫øt ki·ªám</h5>
          <h3 id="total-saved-amount">0 VNƒê</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Goal Progress -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Ti·∫øn ƒë·ªô m·ª•c ti√™u</h5>
    </div>
    <div class="card-body">
      <div id="goal-progress-list"></div>
    </div>
  </div>

  <!-- Active Goals -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">M·ª•c ti√™u ƒëang th·ª±c hi·ªán</h5>
      <div>
        <button id="ai-planning-btn" class="btn btn-info btn-sm me-2">üßô L·∫≠p k·∫ø ho·∫°ch d√†i h·∫°n</button>
        <button id="savings-path-btn" class="btn btn-warning btn-sm me-2" onclick="showSavingsPathModal()">üí∞ L·ªô tr√¨nh ti·∫øt ki·ªám</button>
        <button id="savings-tips-btn" class="btn btn-primary btn-sm me-2" onclick="showSavingsTipsModal()">üìö Savings Tips</button>
        <button id="goal-add-btn" class="btn btn-success btn-sm">+ Th√™m m·ª•c ti√™u</button>
      </div>
    </div>
    <div class="card-body">
      <div id="goal-list"></div>
    </div>
  </div>

  <!-- Completed Goals -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">M·ª•c ti√™u ƒë√£ ho√†n th√†nh</h5>
    </div>
    <div class="card-body">
      <div id="completed-goals-list"></div>
    </div>
  </div>

  <div class="alert alert-info mt-4" id="predict"></div>
</main>

<!-- Goal Modal -->
<div id="goal-modal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="goal-form">
        <div class="modal-header">
          <h5 id="goal-modal-title" class="modal-title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id">
          <div class="mb-3">
            <label class="form-label">T√™n m·ª•c ti√™u</label>
            <input class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">S·ªë ti·ªÅn c·∫ßn ƒë·∫°t</label>
            <input type="number" class="form-control" name="target_amount" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Ng√†y ho√†n th√†nh d·ª± ki·∫øn</label>
            <input type="date" class="form-control" name="due_date" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Hu·ª∑</button>
          <button class="btn btn-success" type="submit">L∆∞u</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ÔøΩ AI Long-term Planning Wizard Modal -->
<div id="ai-planning-modal" class="modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title"> Tr·ª£ l√Ω l·∫≠p k·∫ø ho·∫°ch t√†i ch√≠nh d√†i h·∫°n</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Input -->
        <div id="planning-step-1">
          <h6 class="mb-3">B∆∞·ªõc 1: Nh·∫≠p th√¥ng tin m·ª•c ti√™u</h6>
          <form id="ai-planning-form">
            <div class="mb-3">
              <label class="form-label">Th·ªùi gian l·∫≠p k·∫ø ho·∫°ch</label>
              <select class="form-control" id="plan-months" required>
                <option value="3">3 th√°ng</option>
                <option value="6" selected>6 th√°ng</option>
                <option value="12">12 th√°ng</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">M·ª•c ti√™u ti·∫øt ki·ªám (VNƒê)</label>
              <input type="number" class="form-control" id="target-savings" min="0" step="100000" placeholder="V√≠ d·ª•: 10000000" required>
              <small class="text-muted">S·ªë ti·ªÅn b·∫°n mu·ªën ti·∫øt ki·ªám ƒë∆∞·ª£c trong th·ªùi gian tr√™n</small>
            </div>
            <div class="alert alert-info">
              <strong> AI s·∫Ω ph√¢n t√≠ch:</strong>
              <ul class="mb-0">
                <li>Thu nh·∫≠p trung b√¨nh c·ªßa b·∫°n</li>
                <li>Chi ti√™u hi·ªán t·∫°i theo t·ª´ng danh m·ª•c</li>
                <li>ƒê·ªÅ xu·∫•t m·ª©c ti·∫øt ki·ªám h√†ng th√°ng</li>
                <li>G·ª£i √Ω t·ªëi ∆∞u h√≥a chi ti√™u</li>
              </ul>
            </div>
            <button type="submit" class="btn btn-info w-100">T·∫°o k·∫ø ho·∫°ch v·ªõi AI</button>
          </form>
        </div>

        <!-- Step 2: AI Plan Result -->
        <div id="planning-step-2" style="display: none;">
          <h6 class="mb-3">B∆∞·ªõc 2: K·∫ø ho·∫°ch ƒë∆∞·ª£c AI ƒë·ªÅ xu·∫•t</h6>
          <div id="ai-plan-result"></div>
          <div class="mt-3">
            <button class="btn btn-secondary" onclick="backToPlanningStep1()">¬´ Quay l·∫°i</button>
            <button class="btn btn-success" onclick="applyPlanAsGoal()"> √Åp d·ª•ng k·∫ø ho·∫°ch n√†y</button>
          </div>
        </div>

        <!-- Loading spinner -->
        <div id="planning-loading" style="display: none;" class="text-center py-4">
          <div class="spinner-border text-info" role="status">
            <span class="visually-hidden">ƒêang ph√¢n t√≠ch...</span>
          </div>
          <p class="mt-2">AI ƒëang ph√¢n t√≠ch d·ªØ li·ªáu c·ªßa b·∫°n...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üí∞ Savings Path Wizard Modal -->
<div id="savings-path-modal" class="modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">üí∞ L·ªô tr√¨nh Ti·∫øt ki·ªám Th√¥ng minh</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="savings-path-form">
          <div class="mb-3">
            <label class="form-label">S·ªë ti·ªÅn mu·ªën ti·∫øt ki·ªám (VNƒê)</label>
            <input type="number" class="form-control" id="savings-target-amount" required min="0" step="100000" placeholder="V√≠ d·ª•: 50000000">
          </div>
          <div class="mb-3">
            <label class="form-label">M·ª•c ƒë√≠ch ti·∫øt ki·ªám</label>
            <select class="form-control" id="savings-purpose" required>
              <option value="emergency">Qu·ªπ kh·∫©n c·∫•p</option>
              <option value="education">H·ªçc t·∫≠p</option>
              <option value="house">Mua nh√†</option>
              <option value="car">Mua xe</option>
              <option value="travel">Du l·ªãch</option>
              <option value="business">Kinh doanh</option>
              <option value="retirement">H∆∞u tr√≠</option>
              <option value="other">Kh√°c</option>
            </select>
          </div>
          <button type="submit" class="btn btn-warning w-100">üöÄ T·∫°o l·ªô tr√¨nh v·ªõi AI</button>
        </form>
        <div id="savings-path-result" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<!-- üìö Savings Knowledge Base Modal -->
<div id="savings-tips-modal" class="modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">üìö Savings Knowledge Base</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Danh m·ª•c</label>
            <select class="form-control" id="tips-category">
              <option value="">T·∫•t c·∫£</option>
              <option value="food">ƒÇn u·ªëng</option>
              <option value="transport">Di chuy·ªÉn</option>
              <option value="shopping">Mua s·∫Øm</option>
              <option value="entertainment">Gi·∫£i tr√≠</option>
              <option value="education">Gi√°o d·ª•c</option>
              <option value="health">Y t·∫ø</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">M·ª•c ƒë√≠ch</label>
            <select class="form-control" id="tips-purpose">
              <option value="">Chung</option>
              <option value="student">Sinh vi√™n</option>
              <option value="family">Gia ƒë√¨nh</option>
              <option value="investment">ƒê·∫ßu t∆∞</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary w-100" onclick="loadSavingsTips()">üìñ Xem Knowledge Base</button>
        <div id="savings-tips-result" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<script src="/js/goals.js"></script>
