<main class="container py-4">
  <h2 class="mb-4">Mục tiêu tài chính</h2>
  
  <style>
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    
    .goal-item, .completed-goal-item, .executed-goal-item {
      transition: all 0.3s ease;
    }
    
    .executed-goal-item {
      border: 2px solid #28a745;
    }
  </style>

  <!-- Goal Statistics -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h5 class="card-title">Mục tiêu đang thực hiện</h5>
          <h3 id="active-goals-count">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h5 class="card-title">Mục tiêu đã hoàn thành</h5>
          <h3 id="completed-goals-count">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h5 class="card-title">Tổng tiền tiết kiệm</h5>
          <h3 id="total-saved-amount">0 VNĐ</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Goal Progress -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Tiến độ mục tiêu</h5>
    </div>
    <div class="card-body">
      <div id="goal-progress-list"></div>
    </div>
  </div>

  <!-- Active Goals -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Mục tiêu đang thực hiện</h5>
      <div>
        <button id="ai-planning-btn" class="btn btn-info btn-sm me-2"> Lập kế hoạch dài hạn</button>
        <button id="goal-add-btn" class="btn btn-success btn-sm">+ Thêm mục tiêu</button>
      </div>
    </div>
    <div class="card-body">
      <div id="goal-list"></div>
    </div>
  </div>

  <!-- Completed Goals -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Mục tiêu đã hoàn thành</h5>
    </div>
    <div class="card-body">
      <div id="completed-goals-list"></div>
    </div>
  </div>

  <div class="alert alert-info mt-4" id="predict"></div>
</main>

<!-- Goal Modal -->
<div id="goal-modal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="goal-form">
        <div class="modal-header">
          <h5 id="goal-modal-title" class="modal-title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id">
          <div class="mb-3">
            <label class="form-label">Tên mục tiêu</label>
            <input class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Số tiền cần đạt</label>
            <input type="number" class="form-control" name="target_amount" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Ngày hoàn thành dự kiến</label>
            <input type="date" class="form-control" name="due_date" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Huỷ</button>
          <button class="btn btn-success" type="submit">Lưu</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- � AI Long-term Planning Wizard Modal -->
<div id="ai-planning-modal" class="modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title"> Trợ lý lập kế hoạch tài chính dài hạn</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Input -->
        <div id="planning-step-1">
          <h6 class="mb-3">Bước 1: Nhập thông tin mục tiêu</h6>
          <form id="ai-planning-form">
            <div class="mb-3">
              <label class="form-label">Thời gian lập kế hoạch</label>
              <select class="form-control" id="plan-months" required>
                <option value="3">3 tháng</option>
                <option value="6" selected>6 tháng</option>
                <option value="12">12 tháng</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Mục tiêu tiết kiệm (VNĐ)</label>
              <input type="number" class="form-control" id="target-savings" min="0" step="100000" placeholder="Ví dụ: 10000000" required>
              <small class="text-muted">Số tiền bạn muốn tiết kiệm được trong thời gian trên</small>
            </div>
            <div class="alert alert-info">
              <strong> AI sẽ phân tích:</strong>
              <ul class="mb-0">
                <li>Thu nhập trung bình của bạn</li>
                <li>Chi tiêu hiện tại theo từng danh mục</li>
                <li>Đề xuất mức tiết kiệm hàng tháng</li>
                <li>Gợi ý tối ưu hóa chi tiêu</li>
              </ul>
            </div>
            <button type="submit" class="btn btn-info w-100">Tạo kế hoạch với AI</button>
          </form>
        </div>

        <!-- Step 2: AI Plan Result -->
        <div id="planning-step-2" style="display: none;">
          <h6 class="mb-3">Bước 2: Kế hoạch được AI đề xuất</h6>
          <div id="ai-plan-result"></div>
          <div class="mt-3">
            <button class="btn btn-secondary" onclick="backToPlanningStep1()">« Quay lại</button>
            <button class="btn btn-success" onclick="applyPlanAsGoal()"> Áp dụng kế hoạch này</button>
          </div>
        </div>

        <!-- Loading spinner -->
        <div id="planning-loading" style="display: none;" class="text-center py-4">
          <div class="spinner-border text-info" role="status">
            <span class="visually-hidden">Đang phân tích...</span>
          </div>
          <p class="mt-2">AI đang phân tích dữ liệu của bạn...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/goals.js"></script>
