<!DOCTYPE html> <html lang="vi"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Finance AI</title> <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" href="/css/styles.css"> <style> .sidebar { min-height: 100vh; background: #198754; color: white; } .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 12px 20px; border-radius: 0; } .sidebar .nav-link:hover, .sidebar .nav-link.active { color: white; background: rgba(255,255,255,0.1); } .main-content { margin-left: 250px; } @media (max-width: 768px) { .main-content { margin-left: 0; } .sidebar { position: fixed; z-index: 1000; width: 250px; transform: translateX(-100%); transition: transform 0.3s; } .sidebar.show { transform: translateX(0); } } </style> </head> <body> <!-- Sidebar --> <nav class="sidebar position-fixed" id="sidebar"> <div class="p-3"> <div class="d-flex justify-content-between align-items-center mb-4"> <h4 class="mb-0">Finance AI</h4> <!-- Notification Bell --> <div class="dropdown"> <button class="btn btn-link text-white position-relative p-0" type="button" id="notificationDropdown" data-bs-toggle="dropdown"> <i class="fas fa-bell fs-5"></i> <span id="notificationBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;"> 0 </span> </button> <ul class="dropdown-menu dropdown-menu-end shadow" style="width: 350px; max-height: 400px; overflow-y: auto;"> <li class="dropdown-header d-flex justify-content-between align-items-center"> <span class="fw-bold text-dark">Thông báo</span> <button class="btn btn-sm btn-link text-decoration-none p-0" onclick="markAllAsRead()" id="markAllBtn"> Đọc tất cả </button> </li> <li><hr class="dropdown-divider"></li> <div id="notificationList"> <li class="text-center py-3 text-muted"> <i class="fas fa-bell-slash"></i><br> Không có thông báo </li> </div> </ul> </div> </div> <div class="user-info mb-4 p-2 bg-dark bg-opacity-25 rounded"> <img id="userAvatar" src="https://via.placeholder.com/40/ffffff/198754?text=U" class="rounded-circle me-2" width="40" height="40" alt="Avatar"> <div class="d-inline-block"> <div id="userName" class="fw-bold">Người dùng</div> <small id="userRole" class="text-light">USER</small> </div> </div> </div> <ul class="nav flex-column"> <li class="nav-item"> <a href="/dashboard" class="nav-link"> <i class="fas fa-tachometer-alt me-2"></i> Tổng quan </a> </li> <li class="nav-item"> <a href="/profile" class="nav-link"> <i class="fas fa-user me-2"></i> Hồ sơ </a> </li> <li class="nav-item"> <a href="/wallets" class="nav-link"> <i class="fas fa-wallet me-2"></i> Ví tiền </a> </li> <!-- Categories hidden - AI auto-categorization handles this --> <li class="nav-item"> <a href="/transactions" class="nav-link"> <i class="fas fa-exchange-alt me-2"></i> Giao dịch </a> </li> <li class="nav-item"> <a href="/recurring" class="nav-link"> <i class="fas fa-repeat me-2"></i> Định kỳ </a> </li> <li class="nav-item"> <a href="/budgets" class="nav-link"> <i class="fas fa-calculator me-2"></i> Ngân sách </a> </li> <li class="nav-item"> <a href="/budgets" class="nav-link"> <i class="fas fa-calculator me-2"></i> Ngân sách </a> </li> <li class="nav-item"> <a href="/goals" class="nav-link"> <i class="fas fa-bullseye me-2"></i> Mục tiêu </a> </li> <li class="nav-item"> <a href="/planning" class="nav-link"> <i class="fas fa-chart-line me-2"></i> Kế Hoạch AI </a> </li> <li class="nav-item"> <a href="/chat" class="nav-link"> <i class="fas fa-robot me-2"></i> AI Chat </a> </li> <li class="nav-item"> <a href="/gamification" class="nav-link"> <i class="fas fa-gamepad me-2"></i> Gamification </a> </li> <li class="nav-item mt-3 border-top pt-3"> <a href="#" class="nav-link" onclick="logout()"> <i class="fas fa-sign-out-alt me-2"></i> Đăng xuất </a> </li> </ul> </nav> <!-- Main Content --> <div class="main-content"> <!-- Top Navigation for mobile --> <nav class="navbar navbar-light bg-light d-md-none"> <div class="container-fluid"> <button class="btn btn-outline-success" type="button" onclick="toggleSidebar()"> <i class="fas fa-bars"></i> </button> <span class="navbar-brand mb-0 h1">Finance AI</span> </div> </nav> <!-- Page Content --> <div class="container-fluid p-4"> <!-- Breadcrumb removed to avoid duplication --> <!-- Main content will be injected here --> <div id="pageContent"> <!-- Content will be loaded by individual pages --> </div> </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> <script src="https://kit.fontawesome.com/your-fontawesome-kit.js"></script> <script> // Kiểm tra authentication khi tải trang document.addEventListener('DOMContentLoaded', function() { const token = localStorage.getItem('authToken'); const currentPath = window.location.pathname; // Nếu không có token và không phải trang public if (!token && !isPublicPage(currentPath)) { window.location.href = '/login'; return; } // Nếu có token, load thông tin user if (token) { loadUserInfo(); setActiveNavItem(); } }); function isPublicPage(path) { const publicPages = ['/', '/login', '/register', '/home']; return publicPages.includes(path); } async function loadUserInfo() { try { const response = await fetch('/api/users/profile', { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('authToken') } }); if (response.ok) { const user = await response.json(); document.getElementById('userName').textContent = user.fullName || user.username; document.getElementById('userRole').textContent = user.role; document.getElementById('userAvatar').src = user.imageUrl || 'https://via.placeholder.com/40/ffffff/198754?text=U'; } else if (response.status === 401) { // Token không hợp lệ logout(); } } catch (error) { console.error('Lỗi tải thông tin user:', error); } } function setActiveNavItem() { const currentPath = window.location.pathname; const navLinks = document.querySelectorAll('.sidebar .nav-link'); navLinks.forEach(link => { link.classList.remove('active'); if (link.getAttribute('href') === currentPath) { link.classList.add('active'); } }); // Update breadcrumb const pageNames = { '/dashboard': 'Tổng quan', '/profile': 'Hồ sơ', '/wallets': 'Ví tiền', '/transactions': 'Giao dịch', '/budgets': 'Ngân sách', '/goals': 'Mục tiêu', '/chat': 'AI Chat' }; const currentPageElement = document.getElementById('currentPage'); if (currentPageElement) { currentPageElement.textContent = pageNames[currentPath] || 'Trang hiện tại'; } } function toggleSidebar() { const sidebar = document.getElementById('sidebar'); sidebar.classList.toggle('show'); } function logout() { localStorage.removeItem('authToken'); localStorage.removeItem('user'); window.location.href = '/'; } // ========== NOTIFICATION SYSTEM ========== let currentUserId = null; // Load user and start notification polling async function initNotifications() { const authToken = localStorage.getItem('authToken'); if (!authToken) return; try { const response = await fetch('http://localhost:8080/api/auth/me', { headers: { 'Authorization': `Bearer ${authToken}` } }); if (response.ok) { const user = await response.json(); currentUserId = user.id; // Load initial notifications loadNotifications(); // Poll every 30 seconds setInterval(loadNotifications, 30000); } } catch (error) { console.error('Error initializing notifications:', error); } } // Load notifications async function loadNotifications() { if (!currentUserId) return; const authToken = localStorage.getItem('authToken'); try { // Get unread count const countResponse = await fetch(`http://localhost:8080/api/notifications/${currentUserId}/unread-count`, { headers: { 'Authorization': `Bearer ${authToken}` } }); if (countResponse.ok) { const { unreadCount } = await countResponse.json(); updateBadge(unreadCount); } // Get recent unread notifications const listResponse = await fetch(`http://localhost:8080/api/notifications/${currentUserId}/unread`, { headers: { 'Authorization': `Bearer ${authToken}` } }); if (listResponse.ok) { const notifications = await listResponse.json(); displayNotifications(notifications); } } catch (error) { console.error('Error loading notifications:', error); } } // Update badge function updateBadge(count) { const badge = document.getElementById('notificationBadge'); if (count > 0) { badge.textContent = count > 99 ? '99+' : count; badge.style.display = 'inline-block'; } else { badge.style.display = 'none'; } } // Display notifications function displayNotifications(notifications) { const container = document.getElementById('notificationList'); const markAllBtn = document.getElementById('markAllBtn'); if (!notifications || notifications.length === 0) { container.innerHTML = ` <li class="text-center py-3 text-muted"> <i class="fas fa-bell-slash"></i><br> Không có thông báo mới </li> `; markAllBtn.style.display = 'none'; return; } markAllBtn.style.display = 'inline'; container.innerHTML = notifications.map(notif => { const icon = getNotificationIcon(notif.type); const time = formatTimeAgo(notif.createdAt); return ` <li> <a class="dropdown-item py-2 ${notif.isRead ? 'text-muted' : ''}" href="#" onclick="markAsReadAndNavigate(${notif.id}, '${notif.link || '#'}'); return false;"> <div class="d-flex align-items-start"> <div class="me-2 text-${getNotificationColor(notif.type)}"> <i class="${icon} fa-fw"></i> </div> <div class="flex-grow-1 small"> <div class="fw-bold">${notif.title}</div> <div class="text-muted small">${notif.message}</div> <div class="text-muted" style="font-size: 0.75rem;"> <i class="far fa-clock"></i> ${time} </div> </div> ${!notif.isRead ? '<span class="badge bg-primary rounded-circle" style="width: 8px; height: 8px;"></span>' : ''} </div> </a> </li> <li><hr class="dropdown-divider m-0"></li> `; }).join(''); } // Get notification icon function getNotificationIcon(type) { const icons = { 'achievement': 'fas fa-trophy', 'budget': 'fas fa-calculator', 'goal': 'fas fa-bullseye', 'transaction': 'fas fa-exchange-alt', 'alert': 'fas fa-exclamation-triangle', 'system': 'fas fa-info-circle', 'default': 'fas fa-bell' }; return icons[type] || icons.default; } // Get notification color function getNotificationColor(type) { const colors = { 'achievement': 'warning', 'budget': 'info', 'goal': 'success', 'transaction': 'primary', 'alert': 'danger', 'system': 'secondary', 'default': 'primary' }; return colors[type] || colors.default; } // Format time ago function formatTimeAgo(dateString) { const date = new Date(dateString); const now = new Date(); const seconds = Math.floor((now - date) / 1000); if (seconds < 60) return 'Vừa xong'; if (seconds < 3600) return Math.floor(seconds / 60) + ' phút trước'; if (seconds < 86400) return Math.floor(seconds / 3600) + ' giờ trước'; if (seconds < 604800) return Math.floor(seconds / 86400) + ' ngày trước'; return date.toLocaleDateString('vi-VN'); } // Mark as read and navigate async function markAsReadAndNavigate(notificationId, link) { await markNotificationAsRead(notificationId); if (link && link !== '#') { window.location.href = link; } } // Mark single notification as read async function markNotificationAsRead(notificationId) { const authToken = localStorage.getItem('authToken'); try { await fetch(`http://localhost:8080/api/notifications/read/${notificationId}`, { method: 'PUT', headers: { 'Authorization': `Bearer ${authToken}` } }); loadNotifications(); } catch (error) { console.error('Error marking notification as read:', error); } } // Mark all as read async function markAllAsRead() { if (!currentUserId) return; const authToken = localStorage.getItem('authToken'); try { await fetch(`http://localhost:8080/api/notifications/${currentUserId}/read-all`, { method: 'PUT', headers: { 'Authorization': `Bearer ${authToken}` } }); loadNotifications(); } catch (error) { console.error('Error marking all as read:', error); } } // Initialize notifications when page loads if (localStorage.getItem('authToken')) { initNotifications(); } // ========== END NOTIFICATION SYSTEM ========== // Đóng sidebar khi click outside trên mobile document.addEventListener('click', function(e) { const sidebar = document.getElementById('sidebar'); const isClickInsideSidebar = sidebar.contains(e.target); const isToggleButton = e.target.closest('.navbar-toggler') || e.target.closest('[onclick="toggleSidebar()"]'); if (!isClickInsideSidebar && !isToggleButton && window.innerWidth <= 768) { sidebar.classList.remove('show'); } }); </script> </body> </html> 